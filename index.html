<html>

<head>
    <title>page title</title>
    <link rel="stylesheet" href="style.css">
    <script src="js/jquery.js"></script>

</head>

<body>
    <section class="contaner-fuil">
        <div class="contaner">
            <div class="row">
                <header>
                    <div class="head">
                        <h1>This is a heaing</h1>
                    </div>
                </header>
            </div>
        </div>
    </section>

    <section class="contaner-fuil">
        <div class="contaner">
            <div class="row">
                <div>
                    <div class="contan">
                        <h1>üè™ Shopping Card</h1>
                        <div class="pare">
                         <ul>
                            <li><a class="add-to-cart" href="#" data-name="Apple" data-price="10">Apple $10</a></li>
                            <li><a class="add-to-cart" href="#" data-name="Napa" data-price="2">Napa $2</a></li>
                         </ul>
                        </div>
                        <div class="clear-section">
                            <span id="clear-cart"><a href="#">Clear Cart</a></span>
                        </div>
            
                        <div class="show-cart">
                            <ul id="show-cart"> </ul>
                        </div>

                        <div class="total-cart">
                            <h4>Total Cart: $<span id="total-cart"></span></h4>
                        </div>
            </div>
        </div>
    </section>


    <section class="contaner-fuil">
        <div class="contaner">
            <div class="row">
                <footer>
                    <div class="footer">
                        <h1>This is a heaing</h1>
                    </div>
                </footer>
            </div>
        </div> 
    </section>

    <script>
        $(".add-to-cart").click(function () {
            event.preventDefault();
            var name = $(this).attr('data-name');
            var price = Number($(this).attr('data-price'));
            shoppingCart.addItemToCart(name, price, 1)
            displayCart();
        });

        function displayCart(){
            var cartArray = shoppingCart.listCart();
            var output = "";
            for(var i in cartArray){
                output += "<li>"+cartArray[i].name+" "+cartArray[i].count+"x"+cartArray[i].price+" = "+cartArray[i].total+"<button data-name='" + cartArray[i].name +"' class='subtract-item'>-</button>"+"<button data-name='" + cartArray[i].name +"' class='plus-item'>+</button>"+"<button data-name='"+ cartArray[i].name+"' class='delete-item'>X</button>"+"</li>";
            }
            $('#show-cart').html(output);
            $('#total-cart').html(shoppingCart.totalCart());
        }
        
        
        $("#show-cart").on('click', '.delete-item', function () {
            var name = $(this).attr('data-name');
            shoppingCart.removeItemFromCartAll(name);
            displayCart();
        });


        $("#show-cart").on('click', '.subtract-item', function () {
            var name = $(this).attr('data-name');
            shoppingCart.removeItemFromCart(name);
            displayCart();
        });

        $("#show-cart").on('click', '.plus-item', function () {
            var name = $(this).attr('data-name');
            shoppingCart.addItemToCart(name, 0, 1);
            displayCart();
        });

        $("#clear-cart").click(function(){
            shoppingCart.clearCart();
            displayCart();
        })


        //TODO shopping card function 
        var cart = []; 

        var shoppingCart = {};
        
        shoppingCart.Item = function(name, price, count)
        {
            this.name = name;
            this.price = price;
            this.count = count;
        }
        
        shoppingCart.addItemToCart= function(name, price, count)
        {
            for(var i in cart){
                if(cart[i].name === name){
                    cart[i].count += count;
                    shoppingCart.saveCart();
                    return;
                }
            }
            var item = new shoppingCart.Item(name, price, count);
            cart.push(item);
            shoppingCart.saveCart();
        }

        shoppingCart.removeItemFromCart = function(name)
        {
            for(var i in cart){
                if(cart[i].name === name){
                    cart[i].count --;
                    if (cart[i].count === 0) {
                        cart.splice(i, 1)
                    }
                    break;
                }
            }
            shoppingCart.saveCart();
        }

        shoppingCart.removeItemFromCartAll = function(name)
        {
            for(var i in cart){
                if(cart[i].name === name){
                    cart.splice(i, 1);
                    break;
                }
            }
            shoppingCart.saveCart();
        }

        shoppingCart.clearCart = function()
        {
            cart = [];
            shoppingCart.saveCart();
        }

        shoppingCart.countCart = function()
        {
            var totalCount = 0;
            for(var i in cart){
                totalCount += cart[i].count;
            }

            return totalCount;
        }

        shoppingCart.totalCart = function()
        {
            var totalCost = 0;
            for(var i in cart){
                totalCost += cart[i].price * cart[i].count;
            }
            return totalCost.toFixed(2);
        }

        shoppingCart.listCart = function()
        {
            var cartCopy = [];
            for(i in cart){
                var item = cart[i];
                var itemCopy = {};
                for(var p in item){
                    itemCopy[p] = item[p];
                }
                itemCopy.total = (item.price * item.count).toFixed(2);
                cartCopy.push(itemCopy);
            }
            return cartCopy;
        }
       
        shoppingCart.saveCart = function()
        {
            localStorage.setItem("ShoppingCart", JSON.stringify(cart)); 
        }

        shoppingCart.loadCart = function()
        {
           cart = JSON.parse(localStorage.getItem("ShoppingCart"));
        }
    
        shoppingCart.loadCart();
  
        displayCart()
    </script>
</body>

</html>